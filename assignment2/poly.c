#include "params.h"
#include "poly.h"
#include <stddef.h>

// We need an NTT-friendly prime (2048 | q-1) that is large enough for computing
// our polynomial product in the integers (Z[x]/(x^n+1))
// If the first input has coefficients in [-2048, 2048], and the
// second input has coefficients in [-8,8], the output is bounded by
// [-2048*8*1024, 2048*8*1024], and hence we need to have
// NTT_Q >= 2*2048*8*1024 < 33564673

#define NTT_Q 33564673
#define NTT_ROOT 840
#define NTT_NINV 33531895 // Mod(1/1024, 33564673)

// For your convenience, the following tables contain the required twiddle factors for the forward and the inverse NTT

// Hint 1: twiddle[0] for layer 1 of the NTT; twiddle[1],twiddle[2] for layer 2, twiddle[3-6] for layer 3, ...
// Hint 2: This is in normal domain. We don't use Montgomery multiplication for this exercise.
static const int32_t twiddles_forward[] =
{
6057702, 16166358, 4070676, -3531198, -11260731, -16586522, 10344459, 11900197, -7974996, 7350388, 1227325, 11809804, -7756560, -13079905, 10121756, 1138528, -5665384, -8491986, 2121761, 8735396, 7037169, 3732990, 15236728, -8413164, -8729293, 9759120, 12975937, -14087250, 6110658, 1778108, 9175386, -4314075, 6512804, 11938968, 3172265, -10863968, 10010313, 14033313, 11708223, -255720, 1232856, -988369, -12062971, 7554841, 13705304, 4808176, 13952996, -8758145, 2847371, -4089071, -14112245, -14111874, 2663422, -1599504, -3036860, -4406558, 15781, 3446166, -3783875, 14217049, -8478458, 12661993, -14583628, 1752167, 16126790, -8357758, 11142392, -3914592, 9686916, -15164721, -5809404, -14378180, -14411664, 6613966, -10235835, -6317924, -16027071, 15772976, 4231493, 8415094, -13976724, 9730603, -10704739, 12503729, 10586616, 6932474, -15349951, 408482, 7405458, -15340829, 3973412, 11000739, -2438403, 2082830, 1487922, -14102887, 1331690, -16009575, -5365218, 13215161, 16752026, 486950, 266968, -9325363, 14374018, 15322485, 6173403, 6658688, 1837226, -5605608, 8363900, 2280712, 16508237, 13396396, -16079834, -3754664, -4869100, -15059014, -11135584, -9522304, -6343125, 7233695, 15385892, -15700554, 16386641, 13082561, 1656389, 6565391, -1622294, -16162006, 10780123, -5327877, -9236063, -12131613, -12623191, -16435590, 9730203, -7983483, -2538035, 8723733, 9695408, -11732123, -609838, -4757325, 3247285, -4205762, 12161726, 4818196, -6366421, -16064107, -459016, -7084674, -12456485, -4790605, -7649237, -8796425, 12340568, 13167463, 1187214, -6302602, -6237872, 9423512, 11966731, 7851086, 8827676, -1397792, -13771601, 3156940, -6336600, -4270862, 7104603, -12499976, 685369, 14044989, -12893909, 1896795, -9207673, -15454114, -13058173, 6045432, -15817519, 10075446, 14437219, -8423885, -5710180, -15358299, 5333441, 16500037, 278928, 242916, 3910039, 7510334, -4984074, 14607771, -11083555, 12242031, 15159083, -3850452, 6038548, -13153644, -97738, -15902854, -10516729, -15698808, -13302335, 11653636, -6653991, -9157090, 2943654, -6299758, 3189367, -3216247, -15100795, 961201, 4006754, -6890911, -10558669, 14126824, 2493724, -8455394, 4452853, 9909600, -6981110, 2519215, 5259058, -3532405, -5808331, -296342, -12120025, 15608873, 2080428, -5586093, 9640124, 13952069, -14997539, 11318717, 4074029, -15661688, -1148522, -5186349, 16334827, 10683693, -2037635, -1571580, -13718132, -12807636, 121047, 11642955, 3720491, 4070452, 3059987, -10064352, -6766577, -4219341, -11924882, 705600, -12316658, -5478923, 5658298, -6937991, -8142348, 14517132, 9350474, 5452809, -6184477, -13063833, -1608073, -2969291, -6721293, -3527209, -13652013, 8473218, -9525446, -13462313, -4112892, 13126572, 2981472, 10030325, 1997516, -13322274, -3127916, 7453339, 16081587, 12920912, -4044107, -14471940, -3154678, 2439043, -5572049, 7061914, -10729024, -15107041, -5803974, -8528930, 15618637, 7650048, 7563459, 13609194, -476203, -11991587, 10305678, -1031894, 10528567, 12657395, -9218834, 4358153, -2097763, -8837547, -9042743, 2107225, -6127007, -3841445, -8397836, -11570558, -286215, 8825544, -472645, -9527686, 15966867, 7869918, 1148213, 11871954, -16514301, 1519989, 11484553, -10773238, 3792398, 14252980, -16092301, 15840353, 7595467, -1565232, 9023579, 4027587, -4025915, -1021319, -4233540, -8902734, -4085172, -10939015, -2420569, 6034745, -8224576, 5052149, 10001506, -16158592, 15936183, -11274907, -12018820, 15640695, 8356433, -11333544, -2556635, 2401515, -5482476, 15795470, -6392099, -9637501, 7675924, 8797447, 2731044, -4968703, -2975794, -12673740, 11864994, 11190866, -7919571, 12140215, -4961374, 13807340, 2673136, 2286163, 9403607, -4617444, -13073811, 4974067, 5885858, 16062909, -6698612, 11503307, -11794786, -2020879, -7400133, 10851486, -1038408, -11699793, -4971133, -5941181, -15578447, -448264, -554282, 11428903, 10939323, 13464790, 5631915, 7058657, -4636714, 3571882, -2584940, 862057, -8106345, 1331422, 1743055, -13065897, 14918028, -10262427, -16159823, 8598855, 16585126, 13765157, -1514781, -11713513, -10512225, -8110984, -8910334, 1813262, -6218691, 1216554, -5134318, 11261642, 10428952, 15880905, -314716, -16224318, 11565657, -16755914, -10294442, 7446648, -3442184, 6711785, -2621039, -12783875, 11860445, 996494, -8483570, -10343024, 16530214, 2003489, -10093773, 7556224, 338920, 8809072, 4832840, 15807055, -11645672, -13255411, 8091819, 403141, 9563848, 2044722, 12401000, 7783031, -6768148, 13524785, -815839, -8522459, 11470215, -14387097, 8183132, 1588006, -1724261, -2288632, 3974313, -9586827, -6832186, -5340718, 6724569, -9212324, -15508150, 15642962, 13215610, -14706147, -14203955, -15314448, 10801721, -5380650, 11166616, -12484033, 13064134, 6586593, 15336612, 14084307, -11086281, 8997590, -13735676, 11072637, -976855, -14105737, -10877088, -5833846, 6585040, 7727561, -11556685, 13015066, -11658288, 1313444, 13740384, -10386962, -12488045, 2818574, 719232, -14709061, -11329585, 13249193, -15319749, 15427263, 12107129, 5354102, 10873704, -14079173, -3123522, 840, -13360616, -13951845, -4228806, -12515096, 6223746, -3339185, -3904747, -6107074, 13937960, -1573912, -9551863, -14907848, -3963838, -11472129, 10412771, 16552676, 7261006, 16007109, 3351571, -12930747, 3839512, 14197011, 10711107, 15088243, -15507406, 7880588, -8731645, 15039569, -2442249, 16765108, -12550550, 1161684, -286339, -7104107, 13093433, 3857936, -16070003, 6782697, 458131, -13416762, -4905823, 8886865, 3635606, 2343243, -227479, 11107080, 6445763, -6178413, 8699857, -11222994, -5956231, -5644591, -11558611, -996440, -47252, -9394690, 13256040, 8217562, 10188935, -6702428, -6194044, -3927221, 858125, -5025332, -13624292, -5500063, -4934487, 1080674, 14358574, 16210100, -13021775, 5611080, 11049193, -16004278, -5545112, -3837826, -3305767, -8745995, -3401218, -13467043, 7187390, -16073692, 3351604, -2610289, -1880905, 16589731, -5124408, 7478150, 11120215, 2538072, 14763453, 10335685, -813467, 4214204, 7961579, 1904489, 10985391, 11390873, -9116938, -9171523, 8103853, 6261924, -10699591, -12736111, -9107160, 15617641, 16698878, -12002471, -705118, -9656500, 10659343, 2611719, 4709131, 8807185, -14062014, 1161502, 4846106, 4309961, 10653207, -10343186, 8558007, 1097987, 1750175, 2451129, 3262510, 13703169, 15215167, 10322068, 13424633, -15957148, -7158390, -11315171, -4853457, 13105672, 2956228, -10814997, -16409692, 6808880, 16189672, 10837006, -12072819, 13030542, -8793825, -1956913, 8980887, -8549415, 12189248, -14040793, -11010633, -851334, -16362037, -10179039, 8730576, 3652560, -14506537, -4768940, -5406837, -15673170, -9680430, 9032654, -3723492, -5512748, 16216813, 16236332, -2544893, 618275, 11667345, 220433, 14039007, 3895931, -6645274, 5762809, 5110519, 16590537, 10505819, 15768169, -14570530, 8072691, 6782751, 9897257, 4894548, 5077044, 10417007, 6082603, 3197039, -12136728, 15988931, -2178869, -653191, 2661402, -4905194, -1477964, 8961965, -14142678, -12771779, 12516102, 12618653, -12171072, 4114697, -6283543, -14970574, 342494, -6543361, 3917769, 3074709, -11830276, 15947951, -5645483, -11116442, 11421614, -6105560, -16473640, 2778594, 1856688, 9206060, -15241484, -8208288, -15362082, 13718434, 13179716, 14717817, 25096, 9685375, 1566201, -12928116, -13528976, -12120455, -13974569, -10725081, -12333823, 2196524, 6736100, 8617967, 5667083, -11180385, 8919821, -1412286, 1533896, 8617037, 6874330, -6696577, 12534429, 184923, -11104953, -10548041, 15845793, 985461, 12762357, 3697851, -4416966, -14090741, 4241916, -11494943, 13608898, -14628326, -11460114, -8073436, -3935119, -13213246, 12340662, 7620972, 10414581, 264678, 15564032, 7563635, 2028351, -8194400, -10418638, -7021056, -9164336, 11427246, 1792444, -12982466, 2951881, 2332039, -16456937, -12913995, 740077, -320210, -13674051, -9404946, -15789091, 15534534, 12176701, -7017907, -6017974, 1679647, 1351067, -15031613, -8939361, 16516877, -2468046, -8460575, -15025851, -4132063, 15187777, 9582363, -13830533, 2765556, -3531180, -2916114, 5890538, 16487281, -7789541, 9618903, 2299163, -16757924, -5746747, -10288022, -8858669, -11290911, -4605192, -5600910, 14486450, -5467889, -4335773, 5754276, -14864066, -13700920, -1509461, -8876597, 3733479, -9802891, 1333186, 13963369, 12941790, -3029615, -10085061, 9030379, 14286012, 2904410, -5772633, -5809738, -6858893, 8263373, 14773538, 1681738, 6625519, -7947834, 7947802, 14167093, 920177, 5678798, 14656362, 10096790, -13089388, -5910807, -5684094, 7157773, 14396657, 4387063, 12190172, 565672, 3392220, -6919639, 10148965, 984520, -6414647, 3358944, 5627420, 11679196, -11691068, -15881158, -5940259, -2112921, 2219000, -6634386, -5879992, -5534708, -15211258, -3398851, 7190559, 11331725, 14849108, -6353169, 16196828, 10113789, -154986, 12030984, -3847944, -6041705, 14259963, -6647215, -14342816, 418778, 6623069, -13732268, 10544237, 4326990, -7330357, 4308542, 782042, -7689082, -871201, -1810293, -11675241, -1337692, 13124983, 10354145, -14294926, 4298819, 10760271, -12679412, 294591, 11520491, 5682281, -14123428, 6633505, 2166545, 16484368, 3041534, -4901731, -2760001, 402059, 241519, 12729795, 12388548, 14965170, -16548976, -5458506, -59973, 14785019, 4155944, -1169882, 14961383, -11369773, 12354354, 12155142, -4872682, -965664, 13595658, 2240360, -5934081, -2061865, -10488124, 5110147, -10394862, 4697110, 13092949, 3504963, 16175416, 15392420, -1739833, -13684308, -15044637, 8926196, -16500659, 2991710, 11675473, 5768157, 11791370, -7365195, -12814583, 15959926, -14011300, -9590211, 1919449, -1879200, -6927085, -8661880, -5098301, -9264519, 15520293, 2586840, 522843, 11463062, 9772896, 15087303, -3752876, 16300937, -8794363, -1363816, -15863285, -8866561, 10983930, 11484855, 15413673, -14409744, -1775511, -5432925, -6080352, 16052984, -15061619, 5924175, 8279672, 3600659, -15006048, -489511, -7162864, 11618, -6737445, 13169351, -7424903, -9427958, 7922596, -4341249, -4324952, 1766900, 15784849, -15489623, -9234, -3811576, 15515732, -14149316, -13319401, 2937142, -107559, -220502, 4320304, -11740424, -5713986
};

static const int32_t twiddles_inverse[] =
{
5713986, 11740424, -4320304, 220502, 107559, -2937142, 13319401, 14149316, -15515732, 3811576, 9234, 15489623, -15784849, -1766900, 4324952, 4341249, -7922596, 9427958, 7424903, -13169351, 6737445, -11618, 7162864, 489511, 15006048, -3600659, -8279672, -5924175, 15061619, -16052984, 6080352, 5432925, 1775511, 14409744, -15413673, -11484855, -10983930, 8866561, 15863285, 1363816, 8794363, -16300937, 3752876, -15087303, -9772896, -11463062, -522843, -2586840, -15520293, 9264519, 5098301, 8661880, 6927085, 1879200, -1919449, 9590211, 14011300, -15959926, 12814583, 7365195, -11791370, -5768157, -11675473, -2991710, 16500659, -8926196, 15044637, 13684308, 1739833, -15392420, -16175416, -3504963, -13092949, -4697110, 10394862, -5110147, 10488124, 2061865, 5934081, -2240360, -13595658, 965664, 4872682, -12155142, -12354354, 11369773, -14961383, 1169882, -4155944, -14785019, 59973, 5458506, 16548976, -14965170, -12388548, -12729795, -241519, -402059, 2760001, 4901731, -3041534, -16484368, -2166545, -6633505, 14123428, -5682281, -11520491, -294591, 12679412, -10760271, -4298819, 14294926, -10354145, -13124983, 1337692, 11675241, 1810293, 871201, 7689082, -782042, -4308542, 7330357, -4326990, -10544237, 13732268, -6623069, -418778, 14342816, 6647215, -14259963, 6041705, 3847944, -12030984, 154986, -10113789, -16196828, 6353169, -14849108, -11331725, -7190559, 3398851, 15211258, 5534708, 5879992, 6634386, -2219000, 2112921, 5940259, 15881158, 11691068, -11679196, -5627420, -3358944, 6414647, -984520, -10148965, 6919639, -3392220, -565672, -12190172, -4387063, -14396657, -7157773, 5684094, 5910807, 13089388, -10096790, -14656362, -5678798, -920177, -14167093, -7947802, 7947834, -6625519, -1681738, -14773538, -8263373, 6858893, 5809738, 5772633, -2904410, -14286012, -9030379, 10085061, 3029615, -12941790, -13963369, -1333186, 9802891, -3733479, 8876597, 1509461, 13700920, 14864066, -5754276, 4335773, 5467889, -14486450, 5600910, 4605192, 11290911, 8858669, 10288022, 5746747, 16757924, -2299163, -9618903, 7789541, -16487281, -5890538, 2916114, 3531180, -2765556, 13830533, -9582363, -15187777, 4132063, 15025851, 8460575, 2468046, -16516877, 8939361, 15031613, -1351067, -1679647, 6017974, 7017907, -12176701, -15534534, 15789091, 9404946, 13674051, 320210, -740077, 12913995, 16456937, -2332039, -2951881, 12982466, -1792444, -11427246, 9164336, 7021056, 10418638, 8194400, -2028351, -7563635, -15564032, -264678, -10414581, -7620972, -12340662, 13213246, 3935119, 8073436, 11460114, 14628326, -13608898, 11494943, -4241916, 14090741, 4416966, -3697851, -12762357, -985461, -15845793, 10548041, 11104953, -184923, -12534429, 6696577, -6874330, -8617037, -1533896, 1412286, -8919821, 11180385, -5667083, -8617967, -6736100, -2196524, 12333823, 10725081, 13974569, 12120455, 13528976, 12928116, -1566201, -9685375, -25096, -14717817, -13179716, -13718434, 15362082, 8208288, 15241484, -9206060, -1856688, -2778594, 16473640, 6105560, -11421614, 11116442, 5645483, -15947951, 11830276, -3074709, -3917769, 6543361, -342494, 14970574, 6283543, -4114697, 12171072, -12618653, -12516102, 12771779, 14142678, -8961965, 1477964, 4905194, -2661402, 653191, 2178869, -15988931, 12136728, -3197039, -6082603, -10417007, -5077044, -4894548, -9897257, -6782751, -8072691, 14570530, -15768169, -10505819, -16590537, -5110519, -5762809, 6645274, -3895931, -14039007, -220433, -11667345, -618275, 2544893, -16236332, -16216813, 5512748, 3723492, -9032654, 9680430, 15673170, 5406837, 4768940, 14506537, -3652560, -8730576, 10179039, 16362037, 851334, 11010633, 14040793, -12189248, 8549415, -8980887, 1956913, 8793825, -13030542, 12072819, -10837006, -16189672, -6808880, 16409692, 10814997, -2956228, -13105672, 4853457, 11315171, 7158390, 15957148, -13424633, -10322068, -15215167, -13703169, -3262510, -2451129, -1750175, -1097987, -8558007, 10343186, -10653207, -4309961, -4846106, -1161502, 14062014, -8807185, -4709131, -2611719, -10659343, 9656500, 705118, 12002471, -16698878, -15617641, 9107160, 12736111, 10699591, -6261924, -8103853, 9171523, 9116938, -11390873, -10985391, -1904489, -7961579, -4214204, 813467, -10335685, -14763453, -2538072, -11120215, -7478150, 5124408, -16589731, 1880905, 2610289, -3351604, 16073692, -7187390, 13467043, 3401218, 8745995, 3305767, 3837826, 5545112, 16004278, -11049193, -5611080, 13021775, -16210100, -14358574, -1080674, 4934487, 5500063, 13624292, 5025332, -858125, 3927221, 6194044, 6702428, -10188935, -8217562, -13256040, 9394690, 47252, 996440, 11558611, 5644591, 5956231, 11222994, -8699857, 6178413, -6445763, -11107080, 227479, -2343243, -3635606, -8886865, 4905823, 13416762, -458131, -6782697, 16070003, -3857936, -13093433, 7104107, 286339, -1161684, 12550550, -16765108, 2442249, -15039569, 8731645, -7880588, 15507406, -15088243, -10711107, -14197011, -3839512, 12930747, -3351571, -16007109, -7261006, -16552676, -10412771, 11472129, 3963838, 14907848, 9551863, 1573912, -13937960, 6107074, 3904747, 3339185, -6223746, 12515096, 4228806, 13951845, 13360616, -840, 3123522, 14079173, -10873704, -5354102, -12107129, -15427263, 15319749, -13249193, 11329585, 14709061, -719232, -2818574, 12488045, 10386962, -13740384, -1313444, 11658288, -13015066, 11556685, -7727561, -6585040, 5833846, 10877088, 14105737, 976855, -11072637, 13735676, -8997590, 11086281, -14084307, -15336612, -6586593, -13064134, 12484033, -11166616, 5380650, -10801721, 15314448, 14203955, 14706147, -13215610, -15642962, 15508150, 9212324, -6724569, 5340718, 6832186, 9586827, -3974313, 2288632, 1724261, -1588006, -8183132, 14387097, -11470215, 8522459, 815839, -13524785, 6768148, -7783031, -12401000, -2044722, -9563848, -403141, -8091819, 13255411, 11645672, -15807055, -4832840, -8809072, -338920, -7556224, 10093773, -2003489, -16530214, 10343024, 8483570, -996494, -11860445, 12783875, 2621039, -6711785, 3442184, -7446648, 10294442, 16755914, -11565657, 16224318, 314716, -15880905, -10428952, -11261642, 5134318, -1216554, 6218691, -1813262, 8910334, 8110984, 10512225, 11713513, 1514781, -13765157, -16585126, -8598855, 16159823, 10262427, -14918028, 13065897, -1743055, -1331422, 8106345, -862057, 2584940, -3571882, 4636714, -7058657, -5631915, -13464790, -10939323, -11428903, 554282, 448264, 15578447, 5941181, 4971133, 11699793, 1038408, -10851486, 7400133, 2020879, 11794786, -11503307, 6698612, -16062909, -5885858, -4974067, 13073811, 4617444, -9403607, -2286163, -2673136, -13807340, 4961374, -12140215, 7919571, -11190866, -11864994, 12673740, 2975794, 4968703, -2731044, -8797447, -7675924, 9637501, 6392099, -15795470, 5482476, -2401515, 2556635, 11333544, -8356433, -15640695, 12018820, 11274907, -15936183, 16158592, -10001506, -5052149, 8224576, -6034745, 2420569, 10939015, 4085172, 8902734, 4233540, 1021319, 4025915, -4027587, -9023579, 1565232, -7595467, -15840353, 16092301, -14252980, -3792398, 10773238, -11484553, -1519989, 16514301, -11871954, -1148213, -7869918, -15966867, 9527686, 472645, -8825544, 286215, 11570558, 8397836, 3841445, 6127007, -2107225, 9042743, 8837547, 2097763, -4358153, 9218834, -12657395, -10528567, 1031894, -10305678, 11991587, 476203, -13609194, -7563459, -7650048, -15618637, 8528930, 5803974, 15107041, 10729024, -7061914, 5572049, -2439043, 3154678, 14471940, 4044107, -12920912, -16081587, -7453339, 3127916, 13322274, -1997516, -10030325, -2981472, -13126572, 4112892, 13462313, 9525446, -8473218, 13652013, 3527209, 6721293, 2969291, 1608073, 13063833, 6184477, -5452809, -9350474, -14517132, 8142348, 6937991, -5658298, 5478923, 12316658, -705600, 11924882, 4219341, 6766577, 10064352, -3059987, -4070452, -3720491, -11642955, -121047, 12807636, 13718132, 1571580, 2037635, -10683693, -16334827, 5186349, 1148522, 15661688, -4074029, -11318717, 14997539, -13952069, -9640124, 5586093, -2080428, -15608873, 12120025, 296342, 5808331, 3532405, -5259058, -2519215, 6981110, -9909600, -4452853, 8455394, -2493724, -14126824, 10558669, 6890911, -4006754, -961201, 15100795, 3216247, -3189367, 6299758, -2943654, 9157090, 6653991, -11653636, 13302335, 15698808, 10516729, 15902854, 97738, 13153644, -6038548, 3850452, -15159083, -12242031, 11083555, -14607771, 4984074, -7510334, -3910039, -242916, -278928, -16500037, -5333441, 15358299, 5710180, 8423885, -14437219, -10075446, 15817519, -6045432, 13058173, 15454114, 9207673, -1896795, 12893909, -14044989, -685369, 12499976, -7104603, 4270862, 6336600, -3156940, 13771601, 1397792, -8827676, -7851086, -11966731, -9423512, 6237872, 6302602, -1187214, -13167463, -12340568, 8796425, 7649237, 4790605, 12456485, 7084674, 459016, 16064107, 6366421, -4818196, -12161726, 4205762, -3247285, 4757325, 609838, 11732123, -9695408, -8723733, 2538035, 7983483, -9730203, 16435590, 12623191, 12131613, 9236063, 5327877, -10780123, 16162006, 1622294, -6565391, -1656389, -13082561, -16386641, 15700554, -15385892, -7233695, 6343125, 9522304, 11135584, 15059014, 4869100, 3754664, 16079834, -13396396, -16508237, -2280712, -8363900, 5605608, -1837226, -6658688, -6173403, -15322485, -14374018, 9325363, -266968, -486950, -16752026, -13215161, 5365218, 16009575, -1331690, 14102887, -1487922, -2082830, 2438403, -11000739, -3973412, 15340829, -7405458, -408482, 15349951, -6932474, -10586616, -12503729, 10704739, -9730603, 13976724, -8415094, -4231493, -15772976, 16027071, 6317924, 10235835, -6613966, 14411664, 14378180, 5809404, 15164721, -9686916, 3914592, -11142392, 8357758, -16126790, -1752167, 14583628, -12661993, 8478458, -14217049, 3783875, -3446166, -15781, 4406558, 3036860, 1599504, -2663422, 14111874, 14112245, 4089071, -2847371, 8758145, -13952996, -4808176, -13705304, -7554841, 12062971, 988369, -1232856, 255720, -11708223, -14033313, -10010313, 10863968, -3172265, -11938968, -6512804, 4314075, -9175386, -1778108, -6110658, 14087250, -12975937, -9759120, 8729293, 8413164, -15236728, -3732990, -7037169, -8735396, -2121761, 8491986, 5665384, -1138528, -10121756, 13079905, 7756560, -11809804, -1227325, -7350388, 7974996, -11900197, -10344459, 16586522, 11260731, 3531198, -4070676, -16166358, -6057702
};


// Returns a centered standard representative in [-q/2, q/2)
static int32_t cmod(int32_t a, int32_t q){
  // This is possibly not constant time; for a real implementation this needs to be
  // replaced, e.g., by a Barrett reduction
  a = a % q;
  if(a >= q/2){
    a -= q;
  }
  if(a < -q/2){
    a += q;
  }
  return a;
}

static int32_t zqmul(int32_t a, int32_t b){
  // In an optimized implementation, we would use Montgomery multiplication
  int64_t c = (int64_t)a*b;
  c = c % NTT_Q;
  return cmod(c, NTT_Q);
}


void poly_ntt(int32_t a[WOOKIEE_N]){
  // TODO: implement
}

void poly_basemul(int32_t r[WOOKIEE_N], int32_t a[WOOKIEE_N], int32_t b[WOOKIEE_N]) {
  // TODO: implement
}

void poly_invntt(int32_t a[WOOKIEE_N]){
  // TODO: implement
}


void poly_mul(poly *r, const poly *a, const poly *b)
{
  // leave this unchanged:
  // We need to switch to 32-bit due to the bigger q
  int32_t a32[WOOKIEE_N], b32[WOOKIEE_N], r32[WOOKIEE_N];

  for(size_t i=0;i<WOOKIEE_N;i++){
    // make sure it is centered mod q
    a32[i] = cmod(a->coeffs[i], WOOKIEE_Q);
    b32[i] = cmod(b->coeffs[i], WOOKIEE_Q);

  }

  // ---------------------------------------
  // TODO: implement the actual arithmetic here:


  // ---------------------------------------
  // leave this unchaned:
  for(size_t i=0;i<WOOKIEE_N;i++){
    // cmod NTT_Q first
    r32[i] = cmod(r32[i], NTT_Q);

    // then pmod q
    r->coeffs[i] = r32[i] & (WOOKIEE_Q-1);
  }

}


